from collections import OrderedDict
import io
import csv

#
# Column names from:
# http://www.gks.ru/opendata/storage/7708234640-bdboo2013/structure-20131231t000000.TTL
#

DOC_NAMES = """     1, Наименование                                      , C, 1000
     2, ОКПО                                              , C,    8
     3, ОКОПФ                                             , C,    5
     4, ОКФС                                              , C,    2
     5, ОКВЭД                                             , C,    8
     6, ИНН                                               , C,   10
     7, Код единицы измерения                             , C,    3
     8, Тип отчета                                        , C,    1
     9, 11103                                             , N,   15
    10, 11104                                             , N,   15
    11, 11203                                             , N,   15
    12, 11204                                             , N,   15
    13, 11303                                             , N,   15
    14, 11304                                             , N,   15
    15, 11403                                             , N,   15
    16, 11404                                             , N,   15
    17, 11503                                             , N,   15
    18, 11504                                             , N,   15
    19, 11603                                             , N,   15
    20, 11604                                             , N,   15
    21, 11703                                             , N,   15
    22, 11704                                             , N,   15
    23, 11803                                             , N,   15
    24, 11804                                             , N,   15
    25, 11903                                             , N,   15
    26, 11904                                             , N,   15
    27, 11003                                             , N,   15
    28, 11004                                             , N,   15
    29, 12103                                             , N,   15
    30, 12104                                             , N,   15
    31, 12203                                             , N,   15
    32, 12204                                             , N,   15
    33, 12303                                             , N,   15
    34, 12304                                             , N,   15
    35, 12403                                             , N,   15
    36, 12404                                             , N,   15
    37, 12503                                             , N,   15
    38, 12504                                             , N,   15
    39, 12603                                             , N,   15
    40, 12604                                             , N,   15
    41, 12003                                             , N,   15
    42, 12004                                             , N,   15
    43, 16003                                             , N,   15
    44, 16004                                             , N,   15
    45, 13103                                             , N,   15
    46, 13104                                             , N,   15
    47, 13203                                             , N,   15
    48, 13204                                             , N,   15
    49, 13403                                             , N,   15
    50, 13404                                             , N,   15
    51, 13503                                             , N,   15
    52, 13504                                             , N,   15
    53, 13603                                             , N,   15
    54, 13604                                             , N,   15
    55, 13703                                             , N,   15
    56, 13704                                             , N,   15
    57, 13003                                             , N,   15
    58, 13004                                             , N,   15
    59, 14103                                             , N,   15
    60, 14104                                             , N,   15
    61, 14203                                             , N,   15
    62, 14204                                             , N,   15
    63, 14303                                             , N,   15
    64, 14304                                             , N,   15
    65, 14503                                             , N,   15
    66, 14504                                             , N,   15
    67, 14003                                             , N,   15
    68, 14004                                             , N,   15
    69, 15103                                             , N,   15
    70, 15104                                             , N,   15
    71, 15203                                             , N,   15
    72, 15204                                             , N,   15
    73, 15303                                             , N,   15
    74, 15304                                             , N,   15
    75, 15403                                             , N,   15
    76, 15404                                             , N,   15
    77, 15503                                             , N,   15
    78, 15504                                             , N,   15
    79, 15003                                             , N,   15
    80, 15004                                             , N,   15
    81, 17003                                             , N,   15
    82, 17004                                             , N,   15
    83, 21103                                             , N,   15
    84, 21104                                             , N,   15
    85, 21203                                             , N,   15
    86, 21204                                             , N,   15
    87, 21003                                             , N,   15
    88, 21004                                             , N,   15
    89, 22103                                             , N,   15
    90, 22104                                             , N,   15
    91, 22203                                             , N,   15
    92, 22204                                             , N,   15
    93, 22003                                             , N,   15
    94, 22004                                             , N,   15
    95, 23103                                             , N,   15
    96, 23104                                             , N,   15
    97, 23203                                             , N,   15
    98, 23204                                             , N,   15
    99, 23303                                             , N,   15
   100, 23304                                             , N,   15
   101, 23403                                             , N,   15
   102, 23404                                             , N,   15
   103, 23503                                             , N,   15
   104, 23504                                             , N,   15
   105, 23003                                             , N,   15
   106, 23004                                             , N,   15
   107, 24103                                             , N,   15
   108, 24104                                             , N,   15
   109, 24213                                             , N,   15
   110, 24214                                             , N,   15
   111, 24303                                             , N,   15
   112, 24304                                             , N,   15
   113, 24503                                             , N,   15
   114, 24504                                             , N,   15
   115, 24603                                             , N,   15
   116, 24604                                             , N,   15
   117, 24003                                             , N,   15
   118, 24004                                             , N,   15
   119, 25103                                             , N,   15
   120, 25104                                             , N,   15
   121, 25203                                             , N,   15
   122, 25204                                             , N,   15
   123, 25003                                             , N,   15
   124, 25004                                             , N,   15
   125, 32003                                             , N,   15
   126, 32004                                             , N,   15
   127, 32005                                             , N,   15
   128, 32006                                             , N,   15
   129, 32007                                             , N,   15
   130, 32008                                             , N,   15
   131, 33103                                             , N,   15
   132, 33104                                             , N,   15
   133, 33105                                             , N,   15
   134, 33106                                             , N,   15
   135, 33107                                             , N,   15
   136, 33108                                             , N,   15
   137, 33117                                             , N,   15
   138, 33118                                             , N,   15
   139, 33125                                             , N,   15
   140, 33127                                             , N,   15
   141, 33128                                             , N,   15
   142, 33135                                             , N,   15
   143, 33137                                             , N,   15
   144, 33138                                             , N,   15
   145, 33143                                             , N,   15
   146, 33144                                             , N,   15
   147, 33145                                             , N,   15
   148, 33148                                             , N,   15
   149, 33153                                             , N,   15
   150, 33154                                             , N,   15
   151, 33155                                             , N,   15
   152, 33157                                             , N,   15
   153, 33163                                             , N,   15
   154, 33164                                             , N,   15
   155, 33165                                             , N,   15
   156, 33166                                             , N,   15
   157, 33167                                             , N,   15
   158, 33168                                             , N,   15
   159, 33203                                             , N,   15
   160, 33204                                             , N,   15
   161, 33205                                             , N,   15
   162, 33206                                             , N,   15
   163, 33207                                             , N,   15
   164, 33208                                             , N,   15
   165, 33217                                             , N,   15
   166, 33218                                             , N,   15
   167, 33225                                             , N,   15
   168, 33227                                             , N,   15
   169, 33228                                             , N,   15
   170, 33235                                             , N,   15
   171, 33237                                             , N,   15
   172, 33238                                             , N,   15
   173, 33243                                             , N,   15
   174, 33244                                             , N,   15
   175, 33245                                             , N,   15
   176, 33247                                             , N,   15
   177, 33248                                             , N,   15
   178, 33253                                             , N,   15
   179, 33254                                             , N,   15
   180, 33255                                             , N,   15
   181, 33257                                             , N,   15
   182, 33258                                             , N,   15
   183, 33263                                             , N,   15
   184, 33264                                             , N,   15
   185, 33265                                             , N,   15
   186, 33266                                             , N,   15
   187, 33267                                             , N,   15
   188, 33268                                             , N,   15
   189, 33277                                             , N,   15
   190, 33278                                             , N,   15
   191, 33305                                             , N,   15
   192, 33306                                             , N,   15
   193, 33307                                             , N,   15
   194, 33406                                             , N,   15
   195, 33407                                             , N,   15
   196, 33003                                             , N,   15
   197, 33004                                             , N,   15
   198, 33005                                             , N,   15
   199, 33006                                             , N,   15
   200, 33007                                             , N,   15
   201, 33008                                             , N,   15
   202, 36003                                             , N,   15
   203, 36004                                             , N,   15
   204, 41103                                             , N,   15
   205, 41113                                             , N,   15
   206, 41123                                             , N,   15
   207, 41133                                             , N,   15
   208, 41193                                             , N,   15
   209, 41203                                             , N,   15
   210, 41213                                             , N,   15
   211, 41223                                             , N,   15
   212, 41233                                             , N,   15
   213, 41243                                             , N,   15
   214, 41293                                             , N,   15
   215, 41003                                             , N,   15
   216, 42103                                             , N,   15
   217, 42113                                             , N,   15
   218, 42123                                             , N,   15
   219, 42133                                             , N,   15
   220, 42143                                             , N,   15
   221, 42193                                             , N,   15
   222, 42203                                             , N,   15
   223, 42213                                             , N,   15
   224, 42223                                             , N,   15
   225, 42233                                             , N,   15
   226, 42243                                             , N,   15
   227, 42293                                             , N,   15
   228, 42003                                             , N,   15
   229, 43103                                             , N,   15
   230, 43113                                             , N,   15
   231, 43123                                             , N,   15
   232, 43133                                             , N,   15
   233, 43143                                             , N,   15
   234, 43193                                             , N,   15
   235, 43203                                             , N,   15
   236, 43213                                             , N,   15
   237, 43223                                             , N,   15
   238, 43233                                             , N,   15
   239, 43293                                             , N,   15
   240, 43003                                             , N,   15
   241, 44003                                             , N,   15
   242, 44903                                             , N,   15
   243, 61003                                             , N,   15
   244, 62103                                             , N,   15
   245, 62153                                             , N,   15
   246, 62203                                             , N,   15
   247, 62303                                             , N,   15
   248, 62403                                             , N,   15
   249, 62503                                             , N,   15
   250, 62003                                             , N,   15
   251, 63103                                             , N,   15
   252, 63113                                             , N,   15
   253, 63123                                             , N,   15
   254, 63133                                             , N,   15
   255, 63203                                             , N,   15
   256, 63213                                             , N,   15
   257, 63223                                             , N,   15
   258, 63233                                             , N,   15
   259, 63243                                             , N,   15
   260, 63253                                             , N,   15
   261, 63263                                             , N,   15
   262, 63303                                             , N,   15
   263, 63503                                             , N,   15
   264, 63003                                             , N,   15
   265, 64003                                             , N,   15"""


def yeild_colnames():
    with io.StringIO(DOC_NAMES) as csvfile:
        spamreader = csv.reader(csvfile, delimiter=",")
        for row in spamreader:
            yield(row[1].strip())
COLNAMES = list(yeild_colnames())

# ['Наименование', 'ОКПО', 'ОКОПФ', 'ОКФС', 'ОКВЭД', 'ИНН', 'Код единицы измерения', 'Тип отчета']
# 'okfs' - формы собственности 
firm_attributes      = ['name', 'okpo', 'okopf', 'okfs', 'okved', 'inn', 'unit', 'report_type' ]
COLNAMES[0:8] = firm_attributes 
assert COLNAMES[7] == 'report_type'
assert COLNAMES[8] == '11103'

# баланс
ap  = [x for x in COLNAMES if x.startswith("1")]
# отчет о прибыли и убытках
opu = [x for x in COLNAMES if x.startswith("2")] 
# отчет о движении денежных средств
cf  = [x for x in COLNAMES if x.startswith("4")] 
# отчет о движении капитала
dk  = [x for x in COLNAMES if x.startswith("3")] 
# отчет о целевых расходах
tsel  = [x for x in COLNAMES if x.startswith("6")] 
assert firm_attributes+ap+opu+dk+cf+tsel == COLNAMES

dc = {k:k for k in COLNAMES}
tyd = {x:x[0:-1] for x in dc.keys() if not x.startswith("3") and x.endswith("3")}
dc.update(tyd)
pyd = {x:x[0:-1]+"_lag" for x in dc.keys() if not x.startswith("3") and x.endswith("4")}
dc.update(pyd)
COLNAMES_2013 = [dc[x] for x in COLNAMES]

#
#   Create files with fewer columns
#
#
#   Variable names as seen at 
#   http://info.avtovaz.ru/files/avtovaz_ras_12m_2013.pdf
#
 
rename_dict = OrderedDict([
#             ('name', 'name'),
#             ('okpo', 'okpo'),
#             ('okopf', 'okopf'),
#             ('okfs', 'okfs'),
#             ('okved', 'okved'),
#             ('inn', 'inn'),
#             ('unit', 'unit'),
#             ('report_type', 'report_type'),
#             ('1110', '1110'),
#             ('1110_lag', '1110_lag'),
#             ('1120', '1120'),
#             ('1120_lag', '1120_lag'),
#             ('1130', '1130'),
#             ('1130_lag', '1130_lag'),
#             ('1140', '1140'),
#             ('1140_lag', '1140_lag'),
('1150', 'of'), #основные фонды
('1150_lag', 'of_lag'),
#             ('1160', '1160'),
#             ('1160_lag', '1160_lag'),
#             ('1170', '1170'),
#             ('1170_lag', '1170_lag'),
#             ('1180', '1180'),
#             ('1180_lag', '1180_lag'),
#             ('1190', '1190'),
#             ('1190_lag', '1190_lag'),
 ('1100', 'ta_fix'), #внеоборотные активы
 ('1100_lag', 'ta_fix_lag'),
#             ('1210', '1210'),
#             ('1210_lag', '1210_lag'),
#             ('1220', '1220'),
#             ('1220_lag', '1220_lag'),
#             ('1230', '1230'),
#             ('1230_lag', '1230_lag'),
#             ('1240', '1240'),
#             ('1240_lag', '1240_lag'),
#             ('1250', '1250'),
#             ('1250_lag', '1250_lag'),
#             ('1260', '1260'),
#             ('1260_lag', '1260_lag'),
 ('1200', 'ta_nonfix'), #оборотные активы
 ('1200_lag', 'ta_nonfix_lag'),
  
 ('1600', 'ta'), # активы всего
 ('1600_lag', 'ta_lag'),
  
#             ('1310', '1310'),
#             ('1310_lag', '1310_lag'),
#             ('1320', '1320'),
#             ('1320_lag', '1320_lag'),
#             ('1340', '1340'),
#             ('1340_lag', '1340_lag'),
#             ('1350', '1350'),
#             ('1350_lag', '1350_lag'),
#             ('1360', '1360'),
#             ('1360_lag', '1360_lag'),
#             ('1370', '1370'),
#             ('1370_lag', '1370_lag'),
 ('1300', 'tp_cap'), # капитал
 ('1300_lag', 'tp_cap_lag'),

 ('1410', 'debt_long'), # долгосрочные займы
 ('1410_lag', 'debt_long_lag'),

#             ('1420', '1420'),
#             ('1420_lag', '1420_lag'),
#             ('1430', '1430'),
#             ('1430_lag', '1430_lag'),
#             ('1450', '1450'),
#             ('1450_lag', '1450_lag'),
 ('1400', 'tp_long'), #долгосрочные обязательства 
 ('1400_lag', 'tp_long_lag'),
  
 ('1510', 'debt_short'), # кракосрочные займы
 ('1510_lag', 'debt_short_lag'),
  
#             ('1520', '1520'),
#             ('1520_lag', '1520_lag'),
#             ('1530', '1530'),
#             ('1530_lag', '1530_lag'),
#             ('1540', '1540'),
#             ('1540_lag', '1540_lag'),
#             ('1550', '1550'),
#             ('1550_lag', '1550_lag'),

 ('1500', 'tp_short'), #краткосрочные обязательства 
 ('1500_lag', 'tp_short_lag'),

 ('1700', 'tp'),    # пассивы всего 
 ('1700_lag', 'tp_lag'),

 ('2110', 'sales'), # выручка
 ('2110_lag', 'sales_lag'),
#             ('2120', '2120'),
#             ('2120_lag', '2120_lag'),
#             ('2100', '2100'),
#             ('2100_lag', '2100_lag'),
#             ('2210', '2210'),
#             ('2210_lag', '2210_lag'),
#             ('2220', '2220'),
#             ('2220_lag', '2220_lag'),

 ('2200', 'profit_operational'), #прибыль от продаж
 ('2200_lag', 'profit_operational_lag'),
#             ('2310', '2310'),
#             ('2310_lag', '2310_lag'),
#             ('2320', '2320'),
#             ('2320_lag', '2320_lag'),

 ('2330', 'exp_interest'), # процентные платежи 
 ('2330_lag', 'exp_interest_lag'),
#             ('2340', '2340'),
#             ('2340_lag', '2340_lag'),
#             ('2350', '2350'),
#             ('2350_lag', '2350_lag'),
 ('2300', 'profit_before_tax'), #прибыль до налогообложения
 ('2300_lag', 'profit_before_tax_lag'),
#             ('2410', '2410'),
#             ('2410_lag', '2410_lag'),
#             ('2421', '2421'),
#             ('2421_lag', '2421_lag'),
#             ('2430', '2430'),
#             ('2430_lag', '2430_lag'),
#             ('2450', '2450'),
#             ('2450_lag', '2450_lag'),
#             ('2460', '2460'),
#             ('2460_lag', '2460_lag'),
#             ('2400', '2400'),
#             ('2400_lag', '2400_lag'),
#             ('2510', '2510'),
#             ('2510_lag', '2510_lag'),
#             ('2520', '2520'),
#             ('2520_lag', '2520_lag'),
#             ('2500', '2500'),
#             ('2500_lag', '2500_lag'),
#             ('32003', '32003'),
#             ('32004', '32004'),
#             ('32005', '32005'),
#             ('32006', '32006'),
#             ('32007', '32007'),
#             ('32008', '32008'),
#             ('33103', '33103'),
#             ('33104', '33104'),
#             ('33105', '33105'),
#             ('33106', '33106'),
#             ('33107', '33107'),
#             ('33108', '33108'),
#             ('33117', '33117'),
#             ('33118', '33118'),
#             ('33125', '33125'),
#             ('33127', '33127'),
#             ('33128', '33128'),
#             ('33135', '33135'),
#             ('33137', '33137'),
#             ('33138', '33138'),
#             ('33143', '33143'),
#             ('33144', '33144'),
#             ('33145', '33145'),
#             ('33148', '33148'),
#             ('33153', '33153'),
#             ('33154', '33154'),
#             ('33155', '33155'),
#             ('33157', '33157'),
#             ('33163', '33163'),
#             ('33164', '33164'),
#             ('33165', '33165'),
#             ('33166', '33166'),
#             ('33167', '33167'),
#             ('33168', '33168'),
#             ('33203', '33203'),
#             ('33204', '33204'),
#             ('33205', '33205'),
#             ('33206', '33206'),
#             ('33207', '33207'),
#             ('33208', '33208'),
#             ('33217', '33217'),
#             ('33218', '33218'),
#             ('33225', '33225'),
#             ('33227', '33227'),
#             ('33228', '33228'),
#             ('33235', '33235'),
#             ('33237', '33237'),
#             ('33238', '33238'),
#             ('33243', '33243'),
#             ('33244', '33244'),
#             ('33245', '33245'),
#             ('33247', '33247'),
#             ('33248', '33248'),
#             ('33253', '33253'),
#             ('33254', '33254'),
#             ('33255', '33255'),
#             ('33257', '33257'),
#             ('33258', '33258'),
#             ('33263', '33263'),
#             ('33264', '33264'),
#             ('33265', '33265'),
#             ('33266', '33266'),
#             ('33267', '33267'),
#             ('33268', '33268'),
#             ('33277', '33277'),
#             ('33278', '33278'),
#             ('33305', '33305'),
#             ('33306', '33306'),
#             ('33307', '33307'),
#             ('33406', '33406'),
#             ('33407', '33407'),
#             ('33003', '33003'),
#             ('33004', '33004'),
#             ('33005', '33005'),
#             ('33006', '33006'),
#             ('33007', '33007'),
#             ('33008', '33008'),
#             ('36003', '36003'),
#             ('36004', '36004'),
 ('4110', 'cash_oper_inflow'),        # вcего операционные поступления
 ('4111', 'cash_oper_inflow_sales'),  # поступления от продаж
#             ('4111', '4111'),
#             ('4112', '4112'),
#             ('4113', '4113'),
#             ('4119', '4119'),
#             ('4120', '4120'),
 ('4121', 'paid_to_supplier'),  # платежи поставщикам
 ('4122', 'paid_to_worker'),    # платежи работникам
 ('4123', 'cash_interest'),     # процентные платежи  
#             ('4124', '4124'),
#             ('4129', '4129'),
#             ('4100', '4100'),
#             ('4210', '4210'),
#             ('4211', '4211'),
#             ('4212', '4212'),
#             ('4213', '4213'),
#             ('4214', '4214'),
#             ('4219', '4219'),
#             ('4220', '4220'),
 ('4221', 'cash_investment_of'), # создание внеоборотных активов
#             ('4222', '4222'),
#             ('4223', '4223'),
#             ('4224', '4224'),
#             ('4229', '4229'),
#             ('4200', '4200'),
#             ('4310', '4310'),
#             ('4311', '4311'),
#             ('4312', '4312'),
#             ('4313', '4313'),
#             ('4314', '4314'),
#             ('4319', '4319'),
#             ('4320', '4320'),
#             ('4321', '4321'),
#             ('4322', '4322'),
#             ('4323', '4323'),
#             ('4329', '4329'),
#             ('4300', '4300'),
#             ('4400', '4400'),
#             ('4490', '4490'),
#             ('6100', '6100'),
#             ('6210', '6210'),
#             ('6215', '6215'),
#             ('6220', '6220'),
#             ('6230', '6230'),
#             ('6240', '6240'),
#             ('6250', '6250'),
#             ('6200', '6200'),
#             ('6310', '6310'),
#             ('6311', '6311'),
#             ('6312', '6312'),
#             ('6313', '6313'),
#             ('6320', '6320'),
#             ('6321', '6321'),
#             ('6322', '6322'),
#             ('6323', '6323'),
#             ('6324', '6324'),
#             ('6325', '6325'),
#             ('6326', '6326'),
#             ('6330', '6330'),
#             ('6350', '6350'),
#             ('6300', '6300'),
#             ('6400', '6400')
             ])
 
def switcher(x, renamer=rename_dict):
    if x in renamer.keys():
        return renamer[x]
    else:
        return x
        
COLUMNS_2013_WITH_VARNAMES = [switcher(x) for x in COLNAMES_2013]
